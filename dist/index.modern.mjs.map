{"version":3,"file":"index.modern.mjs","sources":["../src/AppEventBus.ts","../src/GlobalEventsBus.ts"],"sourcesContent":["import  {EventBus}  from './EventBus';\n\nexport class AppEventBus<T> implements EventBus<T> {\n  private events: Map<string, Array<(data: T) => boolean | void>> = new Map();\n\n  on(event: string, listener: (data: T) => boolean | void, index: number = -1): void {\n    if (!this.events.has(event)) {\n      this.events.set(event, []);\n    }\n    const handlers = this.events.get(event)!;\n    if (index < 0 || index >= handlers.length) {\n      handlers.push(listener);\n    } else {\n      handlers.splice(index, 0, listener);\n    }\n  }\n\n  off(event: string, listener: (data: T) => boolean | void): void {\n    if (this.events.has(event)) {\n      this.events.set(event, this.events.get(event)!.filter(h => h !== listener));\n    }\n  }\n\n  emit(event: string, data: T): void {\n    if (this.events.has(event)) {\n      for (const handler of this.events.get(event)!) {\n        if (handler(data) === false) break;\n      }\n    }\n  }\n}\n","import { EventBus } from './EventBus';\n\nexport class GlobalEventBus<T> implements EventBus<T> {\n  private handlers: Map<string, Array<(data: T) => boolean | void>> = new Map();\n\n  on(event: string, listener: (data: T) => boolean | void, index: number = -1): void {\n    if (!this.handlers.has(event)) {\n      this.handlers.set(event, []);\n    }\n\n    const handlers = this.handlers.get(event)!;\n    if (index < 0 || index >= handlers.length) {\n      handlers.push(listener);\n    } else {\n      handlers.splice(index, 0, listener);\n    }\n\n    window.addEventListener(event, this.dispatchHandler as EventListener);\n  }\n\n  off(event: string, listener: (data: T) => boolean | void): void {\n    if (this.handlers.has(event)) {\n      this.handlers.set(event, this.handlers.get(event)!.filter(h => h !== listener));\n      if (this.handlers.get(event)!.length === 0) {\n        window.removeEventListener(event, this.dispatchHandler as EventListener);\n      }\n    }\n  }\n\n  emit(event: string, data: T): void {\n    window.dispatchEvent(new CustomEvent(event, { detail: { data, stopPropagation: false } }));\n  }\n\n  private dispatchHandler = <T>(e: Event): void => {\n    if (!(e instanceof CustomEvent)) return;\n\n    const eventName = e.type;\n    if (!this.handlers.has(eventName)) return;\n\n    for (const handler of this.handlers.get(eventName)!) {\n      if (e.detail.stopPropagation) break;\n\n      if (handler(e.detail.data) === false) {\n        e.detail.stopPropagation = true;\n      }\n    }\n  };\n}\n"],"names":["AppEventBus","constructor","this","events","Map","on","event","listener","index","has","set","handlers","get","length","push","splice","off","filter","h","emit","data","handler","GlobalEventBus","dispatchHandler","e","CustomEvent","eventName","type","detail","stopPropagation","window","addEventListener","removeEventListener","dispatchEvent"],"mappings":"MAEaA,EAAWC,WAAAA,GAAAC,KACdC,OAA0D,IAAIC,GAAK,CAE3EC,EAAAA,CAAGC,EAAeC,EAAuCC,GAAgB,GAClEN,KAAKC,OAAOM,IAAIH,IACnBJ,KAAKC,OAAOO,IAAIJ,EAAO,IAEzB,MAAMK,EAAWT,KAAKC,OAAOS,IAAIN,GAC7BE,EAAQ,GAAKA,GAASG,EAASE,OACjCF,EAASG,KAAKP,GAEdI,EAASI,OAAOP,EAAO,EAAGD,EAE9B,CAEAS,GAAAA,CAAIV,EAAeC,GACbL,KAAKC,OAAOM,IAAIH,IAClBJ,KAAKC,OAAOO,IAAIJ,EAAOJ,KAAKC,OAAOS,IAAIN,GAAQW,OAAOC,GAAKA,IAAMX,GAErE,CAEAY,IAAAA,CAAKb,EAAec,GAClB,GAAIlB,KAAKC,OAAOM,IAAIH,GAClB,IAAK,MAAMe,KAAenB,KAACC,OAAOS,IAAIN,GACpC,IAAsB,IAAlBe,EAAQD,GAAiB,KAGnC,EC3BW,MAAAE,EAAcrB,WAAAA,GACjBU,KAAAA,SAA4D,IAAIP,IA8BhEmB,KAAAA,gBAAsBC,IAC5B,KAAMA,aAAaC,aAAc,OAEjC,MAAMC,EAAYF,EAAEG,KACpB,GAAKzB,KAAKS,SAASF,IAAIiB,GAEvB,IAAK,MAAML,KAAWnB,KAAKS,SAASC,IAAIc,GAAa,CACnD,GAAIF,EAAEI,OAAOC,gBAAiB,OAEC,IAA3BR,EAAQG,EAAEI,OAAOR,QACnBI,EAAEI,OAAOC,iBAAkB,EAE/B,EACD,CAzCDxB,EAAAA,CAAGC,EAAeC,EAAuCC,GAAgB,GAClEN,KAAKS,SAASF,IAAIH,IACrBJ,KAAKS,SAASD,IAAIJ,EAAO,IAG3B,MAAMK,EAAWT,KAAKS,SAASC,IAAIN,GAC/BE,EAAQ,GAAKA,GAASG,EAASE,OACjCF,EAASG,KAAKP,GAEdI,EAASI,OAAOP,EAAO,EAAGD,GAG5BuB,OAAOC,iBAAiBzB,EAAOJ,KAAKqB,gBACtC,CAEAP,GAAAA,CAAIV,EAAeC,GACbL,KAAKS,SAASF,IAAIH,KACpBJ,KAAKS,SAASD,IAAIJ,EAAOJ,KAAKS,SAASC,IAAIN,GAAQW,OAAOC,GAAKA,IAAMX,IAC5B,IAArCL,KAAKS,SAASC,IAAIN,GAAQO,QAC5BiB,OAAOE,oBAAoB1B,EAAOJ,KAAKqB,iBAG7C,CAEAJ,IAAAA,CAAKb,EAAec,GAClBU,OAAOG,cAAc,IAAIR,YAAYnB,EAAO,CAAEsB,OAAQ,CAAER,OAAMS,iBAAiB,KACjF"}