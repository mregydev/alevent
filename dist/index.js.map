{"version":3,"file":"index.js","sources":["../src/AppEventBus.ts","../src/GlobalEventsBus.ts"],"sourcesContent":["import  {EventBus}  from './EventBus';\n\nexport class AppEventBus<T> implements EventBus<T> {\n  private events: Map<string, Array<(data: T) => boolean | void>> = new Map();\n\n  on(event: string, listener: (data: T) => boolean | void, index: number = -1): void {\n    if (!this.events.has(event)) {\n      this.events.set(event, []);\n    }\n    const handlers = this.events.get(event)!;\n    if (index < 0 || index >= handlers.length) {\n      handlers.push(listener);\n    } else {\n      handlers.splice(index, 0, listener);\n    }\n  }\n\n  off(event: string, listener: (data: T) => boolean | void): void {\n    if (this.events.has(event)) {\n      this.events.set(event, this.events.get(event)!.filter(h => h !== listener));\n    }\n  }\n\n  emit(event: string, data: T): void {\n    if (this.events.has(event)) {\n      for (const handler of this.events.get(event)!) {\n        if (handler(data) === false) break;\n      }\n    }\n  }\n}\n","import { EventBus } from './EventBus';\n\nexport class GlobalEventBus<T> implements EventBus<T> {\n  private handlers: Map<string, Array<(data: T) => boolean | void>> = new Map();\n\n  on(event: string, listener: (data: T) => boolean | void, index: number = -1): void {\n    if (!this.handlers.has(event)) {\n      this.handlers.set(event, []);\n    }\n\n    const handlers = this.handlers.get(event)!;\n    if (index < 0 || index >= handlers.length) {\n      handlers.push(listener);\n    } else {\n      handlers.splice(index, 0, listener);\n    }\n\n    window.addEventListener(event, this.dispatchHandler as EventListener);\n  }\n\n  off(event: string, listener: (data: T) => boolean | void): void {\n    if (this.handlers.has(event)) {\n      this.handlers.set(event, this.handlers.get(event)!.filter(h => h !== listener));\n      if (this.handlers.get(event)!.length === 0) {\n        window.removeEventListener(event, this.dispatchHandler as EventListener);\n      }\n    }\n  }\n\n  emit(event: string, data: T): void {\n    window.dispatchEvent(new CustomEvent(event, { detail: { data, stopPropagation: false } }));\n  }\n\n  private dispatchHandler = <T>(e: Event): void => {\n    if (!(e instanceof CustomEvent)) return;\n\n    const eventName = e.type;\n    if (!this.handlers.has(eventName)) return;\n\n    for (const handler of this.handlers.get(eventName)!) {\n      if (e.detail.stopPropagation) break;\n\n      if (handler(e.detail.data) === false) {\n        e.detail.stopPropagation = true;\n      }\n    }\n  };\n}\n"],"names":["AppEventBus","this","events","Map","_proto","prototype","on","event","listener","index","has","set","handlers","get","length","push","splice","off","filter","h","emit","data","_step","_iterator","_createForOfIteratorHelperLoose","done","handler","value","GlobalEventBus","_this","dispatchHandler","e","CustomEvent","eventName","type","detail","stopPropagation","window","addEventListener","removeEventListener","dispatchEvent"],"mappings":"oyBAEa,IAAAA,eAAW,WAAA,SAAAA,IAAAC,KACdC,OAA0D,IAAIC,GAAK,CAAAC,IAAAA,EAAAJ,EAAAK,UA0B1E,OA1B0ED,EAE3EE,GAAA,SAAGC,EAAeC,EAAuCC,QAAAA,IAAAA,IAAAA,GAAiB,GACnER,KAAKC,OAAOQ,IAAIH,IACnBN,KAAKC,OAAOS,IAAIJ,EAAO,IAEzB,IAAMK,EAAWX,KAAKC,OAAOW,IAAIN,GAC7BE,EAAQ,GAAKA,GAASG,EAASE,OACjCF,EAASG,KAAKP,GAEdI,EAASI,OAAOP,EAAO,EAAGD,EAE9B,EAACJ,EAEDa,IAAA,SAAIV,EAAeC,GACbP,KAAKC,OAAOQ,IAAIH,IAClBN,KAAKC,OAAOS,IAAIJ,EAAON,KAAKC,OAAOW,IAAIN,GAAQW,OAAO,SAAAC,GAAC,OAAIA,IAAMX,CAAQ,GAE7E,EAACJ,EAEDgB,KAAA,SAAKb,EAAec,GAClB,GAAIpB,KAAKC,OAAOQ,IAAIH,GAClB,IAAA,IAA6Ce,EAA7CC,EAAAC,EAAsBvB,KAAKC,OAAOW,IAAIN,MAAOe,EAAAC,KAAAE,OACrB,KAAlBC,EADYJ,EAAAK,OACJN,KAGlB,EAACrB,CAAA,CA3BqB,GCAX4B,eAAc,WAAA,SAAAA,IAAA,IAAAC,EACjBjB,KAAAA,KAAAA,SAA4D,IAAIT,IAAKF,KA8BrE6B,gBAAkB,SAAIC,GAC5B,GAAMA,aAAaC,YAAnB,CAEA,IAAMC,EAAYF,EAAEG,KACpB,GAAKL,EAAKjB,SAASF,IAAIuB,GAEvB,IAAAV,IAAmDD,EAAnDC,EAAAC,EAAsBK,EAAKjB,SAASC,IAAIoB,MAAWX,EAAAC,KAAAE,MAAE,CAA1C,IAAAC,EAAOJ,EAAAK,MAChB,GAAII,EAAEI,OAAOC,gBAAiB,OAEC,IAA3BV,EAAQK,EAAEI,OAAOd,QACnBU,EAAEI,OAAOC,iBAAkB,EAE/B,CATA,CAUF,CAAC,CAAAhC,IAAAA,EAAAwB,EAAAvB,iBAAAD,EAzCDE,GAAA,SAAGC,EAAeC,EAAuCC,QAAA,IAAAA,IAAAA,GAAiB,GACnER,KAAKW,SAASF,IAAIH,IACrBN,KAAKW,SAASD,IAAIJ,EAAO,IAG3B,IAAMK,EAAWX,KAAKW,SAASC,IAAIN,GAC/BE,EAAQ,GAAKA,GAASG,EAASE,OACjCF,EAASG,KAAKP,GAEdI,EAASI,OAAOP,EAAO,EAAGD,GAG5B6B,OAAOC,iBAAiB/B,EAAON,KAAK6B,gBACtC,EAAC1B,EAEDa,IAAA,SAAIV,EAAeC,GACbP,KAAKW,SAASF,IAAIH,KACpBN,KAAKW,SAASD,IAAIJ,EAAON,KAAKW,SAASC,IAAIN,GAAQW,OAAO,SAAAC,GAAK,OAAAA,IAAMX,CAAQ,IACpC,IAArCP,KAAKW,SAASC,IAAIN,GAAQO,QAC5BuB,OAAOE,oBAAoBhC,EAAON,KAAK6B,iBAG7C,EAAC1B,EAEDgB,KAAA,SAAKb,EAAec,GAClBgB,OAAOG,cAAc,IAAIR,YAAYzB,EAAO,CAAE4B,OAAQ,CAAEd,KAAAA,EAAMe,iBAAiB,KACjF,EAACR,CAAA,CA7BwB"}